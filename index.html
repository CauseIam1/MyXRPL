<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XRPL AMM Turbocharger</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #0f172a;
        color: #e2e8f0;
        background-image: radial-gradient(
            circle at 10% 20%,
            rgba(30, 58, 138, 0.1) 0%,
            transparent 20%
          ),
          radial-gradient(
            circle at 90% 80%,
            rgba(124, 58, 237, 0.1) 0%,
            transparent 20%
          );
      }

      .nav {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background: linear-gradient(135deg, #1e3a8a 0%, #7e22ce 100%);
        color: white;
        padding: 15px 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .nav h1 {
        font-size: 1.5rem;
        font-weight: 600;
        background: linear-gradient(to right, #93c5fd, #c4b5fd);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 10px rgba(147, 197, 253, 0.3);
      }

      .nav-info {
        display: flex;
        gap: 20px;
        font-size: 0.9rem;
      }

      .nav-info div {
        background: rgba(255, 255, 255, 0.1);
        padding: 8px 15px;
        border-radius: 20px;
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .nav-buttons {
        display: flex;
        gap: 10px;
      }

      .nav-btn {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 8px 15px;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
      }

      .nav-btn:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-2px);
      }

      .container {
        margin-top: 80px;
        padding: 20px;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
      }

      .instructions {
        background: rgba(30, 41, 59, 0.7);
        border: 1px solid rgba(147, 197, 253, 0.2);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
      }

      .instructions h2 {
        color: #93c5fd;
        margin-bottom: 15px;
        font-size: 1.3rem;
      }

      .instructions p {
        margin-bottom: 10px;
        line-height: 1.6;
      }

      .instructions a {
        color: #c4b5fd;
        text-decoration: none;
      }

      .instructions a:hover {
        text-decoration: underline;
      }

      .transactions-header {
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid rgba(147, 197, 253, 0.3);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .transactions-header h2 {
        color: #e2e8f0;
        font-weight: 600;
      }

      .transactions-container {
        background: rgba(15, 23, 42, 0.7);
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        border: 1px solid rgba(147, 197, 253, 0.2);
        backdrop-filter: blur(10px);
      }

      .transaction-item {
        padding: 15px 20px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .transaction-item:last-child {
        border-bottom: none;
      }

      .transaction-details {
        flex: 1;
      }

      .transaction-hash {
        font-family: monospace;
        font-size: 0.85rem;
        color: #94a3b8;
        margin-top: 5px;
      }

      .transaction-type {
        font-weight: 600;
        color: #e2e8f0;
      }

      .transaction-amount {
        font-weight: 600;
        color: #86efac;
      }

      .transaction-date {
        color: #94a3b8;
        font-size: 0.85rem;
      }

      .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 2000;
      }

      .login-box {
        background: rgba(15, 23, 42, 0.9);
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        text-align: center;
        max-width: 500px;
        width: 90%;
        border: 1px solid rgba(147, 197, 253, 0.3);
        backdrop-filter: blur(10px);
      }

      .login-box h2 {
        margin-bottom: 20px;
        color: #e2e8f0;
        font-size: 1.8rem;
        background: linear-gradient(to right, #93c5fd, #c4b5fd);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .login-btn {
        background: linear-gradient(135deg, #1e3a8a 0%, #7e22ce 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        font-size: 1rem;
        border-radius: 30px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 15px;
        width: 100%;
        font-weight: 600;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 15px rgba(30, 58, 138, 0.3);
      }

      .login-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(30, 58, 138, 0.5);
      }

      .account-input {
        width: 100%;
        padding: 15px;
        margin: 15px 0;
        border: 1px solid rgba(147, 197, 253, 0.3);
        border-radius: 8px;
        font-size: 1rem;
        background: rgba(30, 41, 59, 0.7);
        color: #e2e8f0;
      }

      .account-input:focus {
        outline: none;
        border-color: #93c5fd;
        box-shadow: 0 0 0 3px rgba(147, 197, 253, 0.3);
      }

      .loading {
        text-align: center;
        padding: 50px;
        color: #94a3b8;
      }

      .error {
        background: rgba(220, 38, 38, 0.2);
        color: #fecaca;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
        text-align: center;
        border: 1px solid rgba(220, 38, 38, 0.3);
      }

      .swap-section {
        background: rgba(30, 41, 59, 0.7);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        border: 1px solid rgba(147, 197, 253, 0.2);
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }

      .swap-section.pulse-blue {
        animation: pulse-blue 2s infinite;
      }

      .swap-section.pulse-purple {
        animation: pulse-purple 2s infinite;
      }

      @keyframes pulse-blue {
        0% {
          box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
        }
      }

      @keyframes pulse-purple {
        0% {
          box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.7);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(168, 85, 247, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(168, 85, 247, 0);
        }
      }

      .swap-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .swap-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #e2e8f0;
      }

      .remove-btn {
        background: rgba(220, 38, 38, 0.2);
        color: #fecaca;
        border: 1px solid rgba(220, 38, 38, 0.3);
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .remove-btn:hover {
        background: rgba(220, 38, 38, 0.3);
      }

      .swap-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .swap-detail-card {
        background: rgba(15, 23, 42, 0.5);
        border-radius: 8px;
        padding: 15px;
        border: 1px solid rgba(147, 197, 253, 0.1);
      }

      .swap-detail-card h4 {
        color: #93c5fd;
        margin-bottom: 10px;
        font-size: 1rem;
      }

      .swap-detail-card p {
        margin: 5px 0;
        font-size: 0.9rem;
      }

      .swap-amount {
        font-weight: 600;
        color: #e2e8f0;
      }

      .swap-currency {
        color: #c4b5fd;
        font-weight: 500;
      }

      .swap-results {
        background: rgba(15, 23, 42, 0.5);
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
        border: 1px solid rgba(147, 197, 253, 0.1);
      }

      .swap-results h4 {
        color: #93c5fd;
        margin-bottom: 10px;
      }

      .result-row {
        display: flex;
        justify-content: space-between;
        margin: 8px 0;
      }

      .result-label {
        color: #94a3b8;
      }

      .result-value {
        font-weight: 600;
        color: #e2e8f0;
      }

      .profit-positive {
        color: #86efac;
      }

      .profit-negative {
        color: #fca5a5;
      }

      .recommendation {
        background: rgba(34, 197, 94, 0.1);
        border: 1px solid rgba(34, 197, 94, 0.3);
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
      }

      .recommendation.negative {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
      }

      .recommendation h4 {
        color: #86efac;
        margin-bottom: 5px;
      }

      .recommendation.negative h4 {
        color: #fca5a5;
      }

      .recommendation p {
        font-size: 0.9rem;
        line-height: 1.5;
      }

      .no-swaps {
        text-align: center;
        padding: 40px;
        color: #94a3b8;
        font-style: italic;
      }

      .github-link {
        text-align: center;
        padding: 30px 0;
        color: #94a3b8;
        font-size: 0.9rem;
      }

      .github-link a {
        color: #93c5fd;
        text-decoration: none;
      }

      .github-link a:hover {
        text-decoration: underline;
      }

      .load-more-container {
        text-align: center;
        margin: 20px 0;
      }

      .load-more-btn {
        background: rgba(147, 197, 253, 0.2);
        color: #93c5fd;
        border: 1px solid rgba(147, 197, 253, 0.3);
        padding: 10px 20px;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .load-more-btn:hover {
        background: rgba(147, 197, 253, 0.3);
        transform: translateY(-2px);
      }

      .progress-bar {
        height: 4px;
        background: rgba(147, 197, 253, 0.2);
        border-radius: 2px;
        margin: 10px 0;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #1e3a8a, #7e22ce);
        width: 0%;
        transition: width 0.3s ease;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div id="login-screen" class="login-container">
        <div class="login-box">
          <h2>XRPL AMM Turbocharger</h2>
          <div class="instructions">
            <h2>How It Works</h2>
            <p>
              Using the
              <a
                href="https://play.google.com/store/apps/details?id=co.xrp.xaman"
                target="_blank"
                >Xaman App</a
              >
              & using your favorite Xapp.
            </p>
            <p>
              Pick 2 noncorrelating XRPL tokens & create an AMM pool. Set the
              fees for the pool at 1%
            </p>
            <p>
              Make sure it's equal portions of each (eg. 5 xrp worth of each)
            </p>
            <p>
              Keep a small pile of each asset in your wallet as you'll be doing
              some swaps through your AMM.
            </p>
            <p>Make very small trades until you understand how it all works.</p>
            <p>Stage 2 is in concept. Going to add Nitrous.</p>
          </div>
          <input
            type="text"
            id="account-input"
            class="account-input"
            placeholder="Enter XRP Account Address (r...)"
          />
          <button id="view-btn" class="login-btn">Go Time</button>
        </div>
      </div>

      <nav id="nav-bar" class="nav" style="display: none">
        <h1>XRPL AMM Turbocharger</h1>
        <div class="nav-info">
          <div id="account-address">Address: Loading...</div>
          <div id="ledger-index">Ledger: Loading...</div>
        </div>
        <div class="nav-buttons">
          <button id="refresh-btn" class="nav-btn">Refresh</button>
          <button id="disconnect-btn" class="nav-btn">Disconnect</button>
        </div>
      </nav>

      <div id="main-content" class="container" style="display: none">
        <div id="swaps-container">
          <div class="loading">Analyzing your AMM swaps...</div>
        </div>
        <div
          class="load-more-container"
          id="load-more-container"
          style="display: none"
        >
          <button id="load-more-btn" class="load-more-btn">
            Load More Transactions
          </button>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>
        </div>
      </div>

      <div class="github-link">
        <p>
          GitHub Repository:
          <a href="#" id="github-link">[Placeholder for GitHub link]</a>
        </p>
      </div>
    </div>

    <script>
      let accountAddress = null;
      let xrplClient = null;
      let allTransactions = [];
      let previousSwaps = [];
      let removedSwaps = new Set();
      let marker = null; // For pagination
      let isLoadingMore = false;

      // Currency code mappings
      const currencyMappings = {
        "245452554D500000000000000000000000000000": "$Trump",
        "4D454C414E494100000000000000000000000000": "Melania",
        "424152524F4E5452554D50000000000000000000": "BARRONTRUMP",
      };

      // Initialize XRPL client
      function initXRPL() {
        xrplClient = new WebSocket("wss://s1.ripple.com:443");

        xrplClient.onopen = () => {
          console.log("Connected to XRPL");
          updateLedgerInfo();

          // Subscribe to ledger updates
          xrplClient.send(
            JSON.stringify({
              id: 1,
              command: "subscribe",
              streams: ["ledger"],
            })
          );
        };

        xrplClient.onmessage = (event) => {
          const data = JSON.parse(event.data);
          if (data.type === "ledgerClosed") {
            document.getElementById(
              "ledger-index"
            ).textContent = `Ledger: ${data.ledger_index}`;
          }
        };

        xrplClient.onerror = (error) => {
          console.error("XRPL Connection Error:", error);
        };
      }

      // Update ledger information
      function updateLedgerInfo() {
        if (xrplClient && xrplClient.readyState === WebSocket.OPEN) {
          xrplClient.send(
            JSON.stringify({
              id: 2,
              command: "ledger_current",
            })
          );
        }
      }

      // View account handler
      document
        .getElementById("view-btn")
        .addEventListener("click", async () => {
          const input = document.getElementById("account-input").value.trim();
          if (!input || !input.startsWith("r")) {
            alert("Please enter a valid XRP account address");
            return;
          }

          accountAddress = input;
          document.getElementById(
            "account-address"
          ).textContent = `Address: ${accountAddress}`;

          // Show main content
          document.getElementById("login-screen").style.display = "none";
          document.getElementById("nav-bar").style.display = "flex";
          document.getElementById("main-content").style.display = "block";

          // Initialize XRPL connection
          initXRPL();

          // Load transactions
          marker = null; // Reset marker
          allTransactions = [];
          loadTransactions();
        });

      // Disconnect handler
      document
        .getElementById("disconnect-btn")
        .addEventListener("click", () => {
          if (xrplClient) {
            xrplClient.close();
          }
          document.getElementById("nav-bar").style.display = "none";
          document.getElementById("main-content").style.display = "none";
          document.getElementById("login-screen").style.display = "flex";
          document.getElementById("account-input").value = "";
          allTransactions = [];
          previousSwaps = [];
          removedSwaps.clear();
          marker = null;
        });

      // Refresh handler
      document.getElementById("refresh-btn").addEventListener("click", () => {
        removedSwaps.clear();
        marker = null; // Reset marker for fresh load
        allTransactions = [];
        loadTransactions();
      });

      // Load more transactions handler
      document.getElementById("load-more-btn").addEventListener("click", () => {
        if (!isLoadingMore && marker) {
          loadMoreTransactions();
        }
      });

      // Load account transactions using XRPL WebSocket
      async function loadTransactions() {
        if (!accountAddress || !xrplClient) return;

        try {
          // Create a new WebSocket connection for account transactions
          const ws = new WebSocket("wss://s1.ripple.com:443");

          ws.onopen = () => {
            const request = {
              id: 1,
              command: "account_tx",
              account: accountAddress,
              ledger_index_min: -1,
              ledger_index_max: -1,
              limit: 200, // Increased limit
              forward: false,
            };

            if (marker) {
              request.marker = marker;
            }

            ws.send(JSON.stringify(request));
          };

          ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.result && data.result.transactions) {
              // Add new transactions to our collection
              allTransactions = [
                ...allTransactions,
                ...data.result.transactions,
              ];

              // Update marker for pagination
              marker = data.result.marker || null;

              // Update progress bar
              updateProgressBar();

              // Process swaps
              processSwaps();

              // Show/hide load more button
              document.getElementById("load-more-container").style.display =
                marker ? "block" : "none";
            } else {
              document.getElementById("swaps-container").innerHTML =
                '<div class="error">No transactions found for this account</div>';
            }
            ws.close();
          };

          ws.onerror = (error) => {
            console.error("WebSocket Error:", error);
            document.getElementById("swaps-container").innerHTML =
              '<div class="error">Failed to connect to XRPL for transactions</div>';
          };
        } catch (error) {
          console.error("Transaction loading error:", error);
          document.getElementById(
            "swaps-container"
          ).innerHTML = `<div class="error">Failed to load transactions: ${error.message}</div>`;
        }
      }

      // Load more transactions
      async function loadMoreTransactions() {
        if (isLoadingMore || !marker) return;

        isLoadingMore = true;
        document.getElementById("load-more-btn").textContent = "Loading...";

        try {
          // Create a new WebSocket connection for account transactions
          const ws = new WebSocket("wss://s1.ripple.com:443");

          ws.onopen = () => {
            ws.send(
              JSON.stringify({
                id: 1,
                command: "account_tx",
                account: accountAddress,
                ledger_index_min: -1,
                ledger_index_max: -1,
                limit: 200, // Increased limit
                forward: false,
                marker: marker,
              })
            );
          };

          ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.result && data.result.transactions) {
              // Add new transactions to our collection
              allTransactions = [
                ...allTransactions,
                ...data.result.transactions,
              ];

              // Update marker for pagination
              marker = data.result.marker || null;

              // Update progress bar
              updateProgressBar();

              // Process swaps
              processSwaps();

              // Show/hide load more button
              document.getElementById("load-more-container").style.display =
                marker ? "block" : "none";
            }
            ws.close();
            isLoadingMore = false;
            document.getElementById("load-more-btn").textContent =
              "Load More Transactions";
          };

          ws.onerror = (error) => {
            console.error("WebSocket Error:", error);
            isLoadingMore = false;
            document.getElementById("load-more-btn").textContent =
              "Load More Transactions";
          };
        } catch (error) {
          console.error("Transaction loading error:", error);
          isLoadingMore = false;
          document.getElementById("load-more-btn").textContent =
            "Load More Transactions";
        }
      }

      // Update progress bar
      function updateProgressBar() {
        const progressFill = document.getElementById("progress-fill");
        const progress = Math.min(100, (allTransactions.length / 1000) * 100);
        progressFill.style.width = `${progress}%`;
      }

      // Process transactions to find swaps
      function processSwaps() {
        previousSwaps = [];

        // Filter for Payment transactions with SendMax and DeliveredAmount
        const paymentTransactions = allTransactions.filter((item) => {
          const tx = item.tx;
          const meta = item.meta || item.metaData;

          return (
            tx.TransactionType === "Payment" &&
            tx.SendMax &&
            meta &&
            meta.DeliveredAmount
          );
        });

        // Process each payment transaction
        paymentTransactions.forEach((item) => {
          const tx = item.tx;
          const meta = item.meta || item.metaData;

          // Extract asset 1 (SendMax)
          let c1, i1, v1;
          if (typeof tx.SendMax === "string") {
            // XRP - skip this transaction
            return;
          } else {
            c1 = tx.SendMax.currency;
            i1 = tx.SendMax.issuer;
            v1 = parseFloat(tx.SendMax.value);
          }

          // Extract asset 2 (DeliveredAmount)
          let c2, i2, v2;
          if (typeof meta.DeliveredAmount === "string") {
            // XRP - skip this transaction
            return;
          } else {
            c2 = meta.DeliveredAmount.currency;
            i2 = meta.DeliveredAmount.issuer;
            v2 = parseFloat(meta.DeliveredAmount.value);
          }

          // Skip if either asset is XRP
          if (c1 === "XRP" || c2 === "XRP") {
            return;
          }

          // Add to previous swaps
          previousSwaps.push({
            txHash: tx.hash,
            c1,
            i1,
            v1,
            c2,
            i2,
            v2,
            asa1: v1,
            asa2: v2,
          });
        });

        // Display swaps
        displaySwaps();
      }

      // Format currency code
      function formatCurrencyCode(code) {
        if (currencyMappings[code]) {
          return currencyMappings[code];
        }
        if (code.length > 12) {
          return code.substring(0, 12) + "...";
        }
        return code;
      }

      // Format value to 2 decimal places
      function formatValue(value) {
        return parseFloat(value).toFixed(2);
      }

      // Display swaps
      function displaySwaps() {
        const container = document.getElementById("swaps-container");

        // Filter out removed swaps
        const activeSwaps = previousSwaps.filter(
          (swap) => !removedSwaps.has(swap.txHash)
        );

        if (activeSwaps.length === 0) {
          container.innerHTML = `
            <div class="no-swaps">
              <p>You have no Swapped Token in your history. Please make a small Swap to get started.</p>
            </div>
          `;
          return;
        }

        // Take first 8 swaps
        const displaySwaps = activeSwaps.slice(0, 8);

        container.innerHTML = displaySwaps
          .map((swap, index) => {
            const as1 = formatCurrencyCode(swap.c1);
            const as2 = formatCurrencyCode(swap.c2);
            const asa1 = formatValue(swap.asa1);
            const asa2 = formatValue(swap.asa2);

            // Simulate AMM quotes (in a real implementation, you would call the AMM)
            const q1 = (swap.v2 * 0.99).toFixed(2); // Simulated quote
            const q2 = (swap.v1 * 0.99).toFixed(2); // Simulated quote
            const r1 = (q1 * 0.99).toFixed(2); // Simulated reverse swap
            const r2 = (q2 * 0.99).toFixed(2); // Simulated reverse swap

            // Calculate percentages
            const percent1 = (((r1 - asa1) / asa1) * 100).toFixed(2);
            const percent2 = (((r2 - asa2) / asa2) * 100).toFixed(2);

            // Determine pulse classes
            let pulseClass = "";
            if (r1 > asa1 * 2) {
              pulseClass = "pulse-blue";
            } else if (r1 < asa1 * 0.5) {
              pulseClass = "pulse-purple";
            }

            // Determine recommendation
            const profit1 = parseFloat(percent1);
            const profit2 = parseFloat(percent2);
            const avgProfit = (profit1 + profit2) / 2;
            const isProfitable = avgProfit > 25;

            return `
            <div class="swap-section ${pulseClass}" data-hash="${swap.txHash}">
              <div class="swap-header">
                <div class="swap-title">Swap #${index + 1}</div>
                <button class="remove-btn" onclick="removeSwap('${
                  swap.txHash
                }')">Remove</button>
              </div>
              
              <div class="swap-details">
                <div class="swap-detail-card">
                  <h4>Initial Swap</h4>
                  <p>We swapped <span class="swap-amount">${asa1}</span> of <span class="swap-currency">${as1}</span></p>
                  <p>and received <span class="swap-amount">${asa2}</span> of <span class="swap-currency">${as2}</span></p>
                </div>
                
                <div class="swap-detail-card">
                  <h4>Asset 1</h4>
                  <p>Currency: <span class="swap-currency">${as1}</span></p>
                  <p>Issuer: ${swap.i1.substring(0, 10)}...</p>
                  <p>Value: <span class="swap-amount">${asa1}</span></p>
                </div>
                
                <div class="swap-detail-card">
                  <h4>Asset 2</h4>
                  <p>Currency: <span class="swap-currency">${as2}</span></p>
                  <p>Issuer: ${swap.i2.substring(0, 10)}...</p>
                  <p>Value: <span class="swap-amount">${asa2}</span></p>
                </div>
              </div>
              
              <div class="swap-results">
                <h4>AMM Analysis</h4>
                <div class="result-row">
                  <span class="result-label">Quote 1 (${as2} → ${as1}):</span>
                  <span class="result-value">${q1} ${as1}</span>
                </div>
                <div class="result-row">
                  <span class="result-label">Quote 2 (${as1} → ${as2}):</span>
                  <span class="result-value">${q2} ${as2}</span>
                </div>
                <div class="result-row">
                  <span class="result-label">Reverse Swap (${as2} → ${as1}):</span>
                  <span class="result-value ${
                    profit1 >= 0 ? "profit-positive" : "profit-negative"
                  }">${r1} ${as1} (${percent1}%)</span>
                </div>
                <div class="result-row">
                  <span class="result-label">Reverse Swap (${as1} → ${as2}):</span>
                  <span class="result-value ${
                    profit2 >= 0 ? "profit-positive" : "profit-negative"
                  }">${r2} ${as2} (${percent2}%)</span>
                </div>
              </div>
              
              <div class="recommendation ${isProfitable ? "" : "negative"}">
                <h4>Recommendation</h4>
                <p>${
                  isProfitable
                    ? `This swap shows potential for profit with an average gain of ${avgProfit.toFixed(
                        2
                      )}%. 
                     Considering the 1% AMM fee in both directions, this opportunity appears worthwhile.`
                    : `This swap shows limited profit potential with an average gain of ${avgProfit.toFixed(
                        2
                      )}%. 
                     Considering the 1% AMM fee in both directions, this may not be worth pursuing.`
                }</p>
              </div>
            </div>
          `;
          })
          .join("");
      }

      // Remove swap from display
      function removeSwap(hash) {
        removedSwaps.add(hash);
        displaySwaps();
      }

      // Make removeSwap globally accessible
      window.removeSwap = removeSwap;
    </script>
  </body>
</html>
